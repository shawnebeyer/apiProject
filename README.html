<h1 id="lunch-meet-park">Lunch, Meet Park</h1>
<p>Lunch, meet park uses a combination of JavaScript, JQuery, JSON, RESTful APIâ€™s, and other technologies to create an engaging user experience. It harnesses the power of data to help you decide &quot;what&#39;s for lunch today?&quot; and uses your selection to find all the amazing closest parks to that restaurant.</p>
<p>Some functions and notes to try/tried</p>
<p>var app = {};</p>
<p>/////////////////////////////////////////////////////////////////////////////////////
//GETS DATE TO INPUT IN OUR FOURSQUARE AJAX CALL (THEY NEED A CURRENT VERSION TO RUN)
/////////////////////////////////////////////////////////////////////////////////////</p>
<p>function getDate() {
 var date = new Date();
 var day = (function() {
     var newDate = date.getDate().toString();
     if (newDate.length ===1 ) {
        return &#39;0&#39; + newDate;
     }
     else {
         return newDate;
     }
})()
 var year = date.getFullYear().toString();
 var month = (function() {
   if(date.getMonth().toString().length === 1) {
     return &#39;0&#39; +  date.getMonth();
   }
   else {
     return date.getMonth();
   }
 })();
 return year + month + day;
}
app.parksList = [];</p>
<p>///////////////////////////////////////////////
//START GEOLOCATOR TO GET USERS GPS COORDINATES
///////////////////////////////////////////////</p>
<p>app.lat = &#39;&#39;;
app.lng = &#39;&#39;;
app.venueLat = &#39;&#39;;
app.venueLng = &#39;&#39;;
app.getLocation = function() {
    //Askes user to allow us to get their current position
    navigator.geolocation.getCurrentPosition(function(pos) {
        app.lat = pos.coords.latitude;
        app.lng = pos.coords.longitude;
        app.events();
    });
};</p>
<p>//////////////////////////////////////////////
// GETS VENUE INFORMATION BASED ON USER SEARCH
//////////////////////////////////////////////</p>
<p>app.getFood = function(foodItem) {
    // console.log(&#39;foodItem is&#39; + foodItem);
    $.ajax({
        url: &#39;<a href="https://api.foursquare.com/v2/venues/explore/">https://api.foursquare.com/v2/venues/explore/</a>&#39;,
        type: &#39;GET&#39;,
        datatype: &#39;jsonp&#39;,
        data: {
            client_id: &#39;4SMGGYCPXWGPZRECIRHP14VGBT2T40I4W1BR5DRUVQERWA3S&#39;,
            client_secret: &#39;XZFODOUVWBQR1X3DGLGT51WBUZXDUEEMZ0MPFCHTTZLOH011&#39;,
            v: getDate(),
            ll: app.lat + &#39;,&#39; + app.lng,
            query: foodItem,
            limit: 50,
            sortByDistance: 1,
            openNow : true,
            venuePhotos: 1
        },
        success: function(venue) {
            //PROBLEM - these two variable correctly hold the venue&#39;s lat and lng coords seperately, but when
            //generated on screen, they only apply to the first venue return. variables should be given values in
            //each loop below, but how can I keep each value through the loop and apply it to a venue????
            if (venue.response.groups[0].items.length === 0) {
                var $lunchFromHomeThen = $(&#39;<p class="noFoodForYou animated bounce">&#39;).text(&quot;Oh no! Looks like you might have to raid your parents fridge! There doesn&#39;t appear to be any open restaurants near you that have what you&#39;re looking for today. Try searching again!&quot;);
                $(&#39;#container&#39;).append($lunchFromHomeThen);
                // $(&#39;#container&#39;).empty();
            } else {
                // make another else statement to handle if less than 5 venues are populated. Add a class to re style it.
            app.venueLat = venue.response.groups[0].items[0].venue.location.lat;
            app.venueLng = venue.response.groups[0].items[0].venue.location.lng;
            app.displayFood(venue.response.groups[0].items);
            }
        }
    });
};</p>
<p>/////////////////////////////
// DISPLAYS VENUE INFORMATION
/////////////////////////////</p>
<p>app.displayFood = function(foodVenue) {
    $(&#39;#container&#39;).empty();
    // var places = foodVenue;
    // console.log(foodVenue);
    // if (places.length === 0) {
    //     var $lunchFromHomeThen = $(&#39;<p>&#39;).text(&quot;Oh no! We hope you&#39;re brown baggin&#39; it today. There aren&#39;t any open restaurants near you that have whgat you&#39;re looking for&quot;);
    //     $(&#39;#container&#39;).append($lunchFromHomeThen);
    // }
    //     //if there aren&#39;t any results, display this message to the user
    //     if (places.length === 0) {
    //             var zilch = $(&#39;<h4>&#39;).text(&quot;Uh oh.  It looks like there aren&#39;t any open places near you that have guac.&quot;);
    //             $(&#39;section.results&#39;).append(zilch);
    //     }</p>
<pre><code>//Beginning of each loop - loops through our venue options.
$.each(foodVenue, function(i, item) {
    var photoSize = &#39;100x100&#39;;
    var $venueLocation = item.venue.location.lat + &#39;,&#39; + item.venue.location.lng;
    var $venueLattitude = item.venue.location.lat;
    var $venueLongitude = item.venue.location.lng;
    var $dist = &#39;&#39;;
    var $venueAddress = $(&#39;&lt;p class=&quot;address&quot;&gt;&#39;).text(item.venue.location.address);
    var $venueName = $(&#39;&lt;h2&gt;&#39;).text(item.venue.name);
    var $venueHours = $(&#39;&lt;p&gt;&#39;).text(item.venue.hours.status);
    // var $venueIsOpen = $(&#39;&lt;p&gt;&#39;).text(item.venue.hours.isOpen);
    var $venueURL = $(&#39;&lt;a&gt;&#39;).attr(&#39;href&#39;, item.venue.url).text(item.venue.name);
    var $venuePhotos = $(&#39;&lt;img&gt;&#39;).attr(&#39;src&#39;,item.venue.photos.groups[0].items[0].prefix + photoSize + item.venue.photos.groups[0].items[0].suffix);
    // if distance from current location is more than 1000m, convert it to km and attach different concatenation to add to page
        if (item.venue.location.distance &gt; 1000) {
            $dist = $(&#39;&lt;p class=&quot;dist&quot;&gt;&#39;).text(&#39;You are &#39;+ ((item.venue.location.distance/1000).toFixed(1)) + &#39;km away.&#39;);
        } else {
            $dist = $(&#39;&lt;p class=&quot;dist&quot;&gt;&#39;).text(&#39;You are &#39; + item.venue.location.distance + &#39;m away.&#39;);
        }
    var $lunchChoice = $(&#39;&lt;div&gt;&#39;).addClass(&#39;lunchChoice&#39;).append($venuePhotos, $venueName, $venueAddress, $venueURL, $dist);
    $(&#39;.lunchChoice&#39;).addClass(&#39;clearfix&#39;);
    $(&#39;.returnInfo&#39;).addClass(&#39;returnInfoBackground&#39;);
    $lunchChoice.data(&#39;latlng&#39;, $venueLocation);
    $lunchChoice.data(&#39;lat&#39;, $venueLattitude);
    $lunchChoice.data(&#39;lng&#39;, $venueLongitude);
    $(&#39;#container&#39;).append($lunchChoice);

    console.log(item);
    // console.log(item);
}); //End of each loop
</code></pre><p>};</p>
<p>app.venueEvents = function() {
    //make this draggable?
    //on drag/on drop
    $(&#39;#container&#39;).on(&#39;click&#39;,&#39;.lunchChoice&#39;, function() {
        var $venueLatLng = $(this).data(&#39;latlng&#39;);
        var $venuesLat = $(this).data(&#39;lat&#39;);
        var $venuesLng = $(this).data(&#39;lng&#39;);
        console.log($venuesLat)
        //THIS is an attempt to make venue results draggable and droppable on map canvas. Will get to this!!
        // $(function() {
        //             $( &quot;.lunchChoice&quot; ).draggable({scroll: false});
        //             $(&quot;#map-canvas&quot;).droppable({
        //                drop: function (event, ui) {
        //                $( this )
        //                .addClass( &quot;ui-state-highlight&quot; )
        //                app.getParks($venueLatLng, $venuesLat, $venuesLng);
        //                },<br>        //                over: function (event, ui) {
        //                $( this )
        //                .addClass( &quot;ui-state-highlight&quot; )
        //                .find( &quot;p&quot; )
        //                .html( &quot;moving in!&quot; );
        //                },
        //                out: function (event, ui) {
        //                $( this )
        //                .addClass( &quot;ui-state-highlight&quot; )
        //                .find( &quot;p&quot; )
        //                .html( &quot;moving out!&quot; );
        //                }<br>        //             });
        //             $(&#39;#map-canvas&#39;).empty();
        //          });
        app.getParks($venueLatLng, $venuesLat, $venuesLng);
    });
}</p>
<p>// This function will get our parks information
app.getParks = function(venueLocation, venuesLatitude, venuesLongitude) {
    $.ajax({
        url: &#39;<a href="https://api.foursquare.com/v2/venues/explore/">https://api.foursquare.com/v2/venues/explore/</a>&#39;,
        type: &#39;GET&#39;,
        datatype: &#39;jsonp&#39;,
        data: {
            client_id: &#39;4SMGGYCPXWGPZRECIRHP14VGBT2T40I4W1BR5DRUVQERWA3S&#39;,
            client_secret: &#39;XZFODOUVWBQR1X3DGLGT51WBUZXDUEEMZ0MPFCHTTZLOH011&#39;,
            v: getDate(),
            ll: venueLocation,
            section: &#39;outdoors&#39;,
            query: &#39;park&#39;,
            limit: 20,
            radius: 1000,
            venuePhotos: 1
        },
        success: function(venue) {
            //venue now holds the park objects ive asked for in this call.
            // app.displayParks(venue.response.groups[0][&#39;items&#39;], venue.response.groups[0].items[0].venue.location.lat, venue.response.groups[0].items[0].venue.location.lng);
            app.displayParks(venue.response.groups[0][&#39;items&#39;], venuesLatitude, venuesLongitude);
            // app.displayParks(venue.response.groups[0].items[0].venue.location.lat);
            // app.displayParks()
            // console.log(venue.response.groups[0].items[0].venue.location.lat);
            // console.log(venue.response.groups[0].items[0].venue.location.lng);
        }
    });
}</p>
<p>// This function will get each parks coords and information
// app.displayParks = function(park, parkLat, parkLng) {
app.displayParks = function(park, vlat, vlng) {
//park is all the parks info
    $.each(park, function(i, item) {
        // var parkCoords = item.venue.location.lat + &quot;,&quot; + item.venue.location.lng;
        //call google and display map with each parkCoords
        var park = {
            coords: {
                lat: item.venue.location.lat,
                lng: item.venue.location.lng
            },
            name: item.venue.name
        }
        // app.parksList.push(park);
        // or
        app.parksList.push(park.coords);
        // // or
        // app.parksList.push(park.coords.lat);
        // app.parksList.push(park.coords.lng);
    });
    // app.getMap(app.parksList, parkLat, parkLng);
    app.getMap(app.parksList, vlat, vlng);
};</p>
<p>//Display map, centered on user, and show closest parks with markers
//Dont really need parkLat and parkLng
// app.getMap = function(closestParks, parkLat, parkLng) {
app.getMap = function(closestParks, vlat, vlng) {
    console.log(closestParks);
    console.log(app.venueLat, app.venueLng);
    // console.log(parkLat, parkLng);
        var mapOptions = {
            center: {lat: vlat, lng: vlng},
            // center: new google.maps.LatLng(venueLocation),
              zoom: 15,
              streetViewControl: true
        };
        var map = new google.maps.Map(document.getElementById(&#39;map-canvas&#39;), mapOptions);
        map.setTilt(45);
        var venueImage = &#39;images/map.png&#39;;
        //Sets marker on venue selected&#39;s location
        var marker = new google.maps.Marker({
              position: {lat: vlat, lng: vlng},
              map: map,
              title: &#39;Eat here!&#39;,
              icon: venueImage
          });</p>
<pre><code>     //Loops through the closestParks Array and use each value to put a marker on the map.    
    $.each(closestParks, function(i, item) {
        var parkImage = &#39;images/parks.svg&#39;;
        var marker = new google.maps.Marker({
              position: item,
              map: map,
              title: &quot;I&#39;m a park!&quot;,
              draggable:true,
              animation: google.maps.Animation.DROP,
              icon: parkImage
              // position: item
          });

    });
  }
</code></pre><p>app.events = function() {
    //apply an event listener to the form with a class of search
    $(&#39;.search&#39;).on(&#39;submit&#39;, function(ev){
        ev.preventDefault();
        //change up some of the page&#39;s styling
        //now we need to get the user&#39;s input
        var searchQuery = $(this).find(&#39;input[type=search]&#39;).val();
        //pass that value to the app.getArt() method
        app.getFood(searchQuery);
        //Clear the search value - this clears the search bar by passing an empty string to the .val
        $(this).find(&#39;input[type=search]&#39;).val(&#39;&#39;);
    });
};</p>
<p>app.init = function() {
    app.getLocation();
    app.venueEvents();
    // $(&quot;.containerFixed&quot;).sticky({topSpacing:0});
};</p>
<p>$(function() {
    app.init();
});</p>
